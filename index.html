<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DN Live Profit Calc</title>
    <style>
        /* CSS stays mostly the same, added a 'sync' indicator */
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: #e0e0e0; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { display: flex; background: #1e1e1e; border-radius: 20px; overflow: hidden; width: 900px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 1px solid #333; }
        .side-image { width: 40%; background: #2a2a2a background-image: url('ireng.jpg') no-repeat center; background-size: cover; border-right: 1px solid #333; }
        .calc-content { width: 60%; padding: 40px; }
        h2 { margin-top: 0; color: #00d4ff; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 0.85em; color: #999; }
        input { width: 100%; padding: 12px; background: #2a2a2a; border: 1px solid #444; color: #00ff88; border-radius: 8px; box-sizing: border-box; font-size: 1.1em; font-weight: bold; }
        .tax-tag { color: #ff4d4d; font-size: 0.8em; font-weight: bold; margin-top: 5px; }
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .stat-card { background: #252525; padding: 15px; border-radius: 10px; border: 1px solid #333; }
        .stat-card small { color: #888; font-size: 0.75em; display: block; margin-bottom: 5px; }
        .stat-card div { font-size: 1.2em; font-weight: bold; }
        .verdict { padding: 20px; border-radius: 10px; text-align: center; font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .profit { background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; color: #00ff88; }
        .loss { background: rgba(255, 77, 77, 0.1); border: 1px solid #ff4d4d; color: #ff4d4d; }
        #live-status { font-size: 0.7em; color: #00ff88; margin-bottom: 10px; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="side-image"></div>
    <div class="calc-content">
        <h2>DN Profit Comparison</h2>
        <span id="live-status">● Fetching Live Rates...</span>
        
        <div class="input-group">
            <label>Gold Rate (IDR per 1,000g)</label>
            <input type="number" id="idrRate" value="113" oninput="update()">
        </div>

        <div class="input-group">
            <label>Lavish Market Price (Gold)</label>
            <input type="number" id="lavishPrice" value="65000" oninput="update()">
            <div class="tax-tag">TAX INCLUDED 10% ON TH</div>
        </div>

        <div id="verdictBox" class="verdict">Analyzing...</div>

        <div class="stats">
            <div class="stat-card">
                <small>MYR PROFIT/LOSS</small>
                <div id="myrDiff">RM 0.00</div>
            </div>
            <div class="stat-card">
                <small>SGD PROFIT/LOSS</small>
                <div id="sgdDiff">S$ 0.00</div>
            </div>
        </div>

        <div style="font-size: 0.75em; color: #555;">
            * Lavish Cost: 5,900 CC (~RM 17.92 based on 100k pack)
        </div>
    </div>
</div>

<script>
// Default fallback rates in case API fails
let MYR_TO_IDR = 4325;
let MYR_TO_SGD = 0.32;

// Fetch Live Rates on Page Load
async function fetchRates() {
    try {
        const response = await fetch('https://api.frankfurter.app/latest?from=MYR&to=IDR,SGD');
        const data = await response.json();
        MYR_TO_IDR = data.rates.IDR;
        MYR_TO_SGD = data.rates.SGD;
        document.getElementById('live-status').innerText = `● Live Rates: 1 MYR = ${MYR_TO_IDR.toFixed(0)} IDR | 1 MYR = ${MYR_TO_SGD.toFixed(2)} SGD`;
        update();
    } catch (error) {
        document.getElementById('live-status').innerText = "○ Using Offline Backup Rates";
        document.getElementById('live-status').style.color = "#ff4d4d";
        update();
    }
}

function update() {
    const CC_100K_RM = 303.72; 
    const LAVISH_CC = 5900;
    const TAX = 0.90;

    const idrRate = parseFloat(document.getElementById('idrRate').value) || 0;
    const listedPrice = parseFloat(document.getElementById('lavishPrice').value) || 0;

    // 1. Lavish Side
    const goldReceived = listedPrice * TAX;
    const lavishCostMYR = (LAVISH_CC / 100000) * CC_100K_RM;
    
    // 2. Seller Side (Live MYR conversion)
    const myrPer1k = idrRate / (MYR_TO_IDR / 1000);
    const sellerCostForSameGold = (goldReceived / 1000) * myrPer1k;

    const profitMYR = sellerCostForSameGold - lavishCostMYR;
    const profitSGD = profitMYR * MYR_TO_SGD;

    const vBox = document.getElementById('verdictBox');
    const myrDisp = document.getElementById('myrDiff');
    const sgdDisp = document.getElementById('sgdDiff');

    if (profitMYR > 0) {
        vBox.className = "verdict profit";
        vBox.innerHTML = "RESULT: SELL LAVISH";
        myrDisp.innerText = "+ RM " + profitMYR.toFixed(2);
        sgdDisp.innerText = "+ S$ " + profitSGD.toFixed(2);
    } else {
        vBox.className = "verdict loss";
        vBox.innerHTML = "RESULT: BUY FROM SELLER";
        myrDisp.innerText = "- RM " + Math.abs(profitMYR).toFixed(2);
        sgdDisp.innerText = "- S$ " + Math.abs(profitSGD).toFixed(2);
    }
}

// Kick off the API fetch
fetchRates();
</script>

</body>
</html>
